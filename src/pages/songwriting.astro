---
import BaseLayout from '../layouts/BaseLayout.astro';
import Masonry from '../components/Masonry.astro';
import PostCard from '../components/PostCard.astro';
import StreamMarker from '../components/StreamMarker.astro';
import { getAllPosts } from '../lib/content.js';
import { contentStreams } from '../lib/site.js';

const songwritingStream = contentStreams.find(stream => stream.key === 'songwriting');
const posts = await getAllPosts();

const songwritingPosts = posts.filter(post => {
  const tags = (post.tags || []).map(tag => String(tag).toLowerCase());
  return songwritingStream?.matches.some(match => tags.includes(match));
});
---

<BaseLayout title="Music" description="Songs, writing, and childlike wonder" layout="songwriting">
  <header class="full | bg-hero-pattern section" style="--spot-color: color-mix(in oklab, var(--color-bg) 60%, transparent)">
    <div class="section__inner region">
      <div class="wrapper flow prose text-center">
        <h1 class="gradient-text-linear">Music</h1>
      </div>
    </div>
  </header>

  <div class="wrapper region flow prose" style="--region-space-top: var(--space-xl-2xl)">
    {songwritingStream && <StreamMarker stream={songwritingStream} />}
    <p>
      A place for songs, half-finished drafts, and reflections that begin in play before they become polished.
    </p>

    {
      songwritingPosts.length > 0 ? (
        <Masonry layout="50-50">
          {songwritingPosts.map(post => <PostCard item={post} />)}
        </Masonry>
      ) : (
        <p>
          No music entries are published yet. They are coming.
        </p>
      )
    }
  </div>
</BaseLayout>
