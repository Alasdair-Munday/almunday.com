---
import BaseLayout from '../../layouts/BaseLayout.astro';
import StreamLandingIntro from '../../components/StreamLandingIntro.astro';
import StreamLandingList from '../../components/StreamLandingList.astro';
import SvgIcon from '../../components/SvgIcon.astro';
import { getAllProjects } from '../../lib/content.js';
import { contentStreams, site } from '../../lib/site.js';
import { buildPaginatedStreamItems, getStreamByKey } from '../../lib/stream-landing.js';

const devStream = getStreamByKey(contentStreams, 'dev');
const pageSize = devStream?.landing?.pageSize || 8;
const projects = await getAllProjects();
const { items, totalPages } = buildPaginatedStreamItems({
  items: projects,
  pageSize,
  stream: devStream,
  filterByMatches: devStream?.landing?.filterByMatches
});
const paginationConfig = site[devStream?.landing?.pagination || 'projects'];
---

<BaseLayout
  title={devStream?.landing?.title || devStream?.label || 'Projects'}
  description={devStream?.description || 'A showcase of my work.'}
  layout={devStream?.landing?.layout || 'projects'}
>
  <div class="wrapper">
    <header class="full | bg-hero-pattern section" style="--spot-color: color-mix(in oklab, var(--color-bg) 60%, transparent)">
      <div class="section__inner region">
        <div class="wrapper flow prose text-center">
          <h1 class="gradient-text-linear text-step-4">{devStream?.label || 'Computers'}</h1>
        </div>
      </div>
      <SvgIcon name="divider/edgy" className="divider" />
    </header>

    <StreamLandingIntro
      stream={devStream}
      intro={devStream?.landing?.intro}
      style="--region-space-top: var(--space-l); margin-block-end: var(--space-xl-2xl);"
    />

    <StreamLandingList
      items={items}
      emptyMessage={devStream?.landing?.emptyMessage}
      pagination={{
        currentPage: 1,
        totalPages,
        basePath: devStream?.href || '/projects/',
        label: paginationConfig?.paginationLabel,
        previousText: paginationConfig?.paginationPrevious,
        nextText: paginationConfig?.paginationNext,
        pageText: paginationConfig?.paginationPage,
        showNumbers: paginationConfig?.paginationNumbers
      }}
    />
  </div>
</BaseLayout>
