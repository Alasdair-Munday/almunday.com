---
import BaseLayout from '../../layouts/BaseLayout.astro';
import StreamLandingIntro from '../../components/StreamLandingIntro.astro';
import StreamLandingList from '../../components/StreamLandingList.astro';
import SvgIcon from '../../components/SvgIcon.astro';
import { getAllPosts } from '../../lib/content.js';
import { contentStreams, site } from '../../lib/site.js';
import { buildPaginatedStreamItems, getStreamByKey } from '../../lib/stream-landing.js';

const faithStream = getStreamByKey(contentStreams, 'faith');
const pageSize = faithStream?.landing?.pageSize || 8;
const posts = await getAllPosts();
const { items, totalPages } = buildPaginatedStreamItems({
  items: posts,
  pageSize,
  stream: faithStream,
  filterByMatches: faithStream?.landing?.filterByMatches
});
const paginationConfig = site[faithStream?.landing?.pagination || 'blog'];
---

<BaseLayout
  title={faithStream?.landing?.title || faithStream?.label || 'Blog'}
  description={faithStream?.description || 'All blog posts can be found here'}
  layout={faithStream?.landing?.layout || 'blog'}
>
  <div class="wrapper">
    <header class="full | bg-hero-pattern section" style="--spot-color: color-mix(in oklab, var(--color-bg) 60%, transparent)">
      <div class="section__inner region">
        <div class="wrapper flow prose text-center">
          <h1 class="gradient-text-linear text-step-4">{faithStream?.label || 'Jesus'}</h1>
        </div>
      </div>
      <SvgIcon name="divider/edgy" className="divider" />
    </header>

    <StreamLandingIntro stream={faithStream} intro={faithStream?.landing?.intro} />

    <StreamLandingList
      items={items}
      emptyMessage={faithStream?.landing?.emptyMessage}
      pagination={{
        currentPage: 1,
        totalPages,
        basePath: faithStream?.href || '/blog/',
        label: paginationConfig?.paginationLabel,
        previousText: paginationConfig?.paginationPrevious,
        nextText: paginationConfig?.paginationNext,
        pageText: paginationConfig?.paginationPage,
        showNumbers: paginationConfig?.paginationNumbers
      }}
    />
  </div>
</BaseLayout>
